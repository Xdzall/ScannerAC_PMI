@page
@model IndexModel
@{
    DateTime shift1Start = DateTime.Now.Date.AddHours(7);
    DateTime shift1End = DateTime.Now.Date.AddHours(15).AddMinutes(45);
    DateTime shift2Start = DateTime.Now.Date.AddHours(15).AddMinutes(45);
    DateTime shift2End = DateTime.Now.Date.AddHours(23);
    DateTime shift3Start = DateTime.Now.Date.AddHours(23);
    DateTime shift3End = DateTime.Now.Date.AddDays(1).AddHours(7);
    DateTime shift3End2 = DateTime.Now.Date.AddHours(7);
    DateTime shift3Start2 = DateTime.Now.Date.AddDays(-1).AddHours(23);
    int shift = 0;
    decimal idletime;
    var currentDate = DateTime.Now.Date;
    var orderedRecords = Model.listUsers.Where(u => u.MachineCode == "MCH1-02")
                                       .OrderByDescending(u => u.SDate)
                                       .Take(150)
                                       .ToList();
    var currentRecord = orderedRecords.FirstOrDefault();
    var previousRecord = orderedRecords.Skip(1).FirstOrDefault();
    var firstRecordToday = Model.listUsers.FirstOrDefault(u => u.MachineCode == "MCH1-02" && u.SDate.Date == currentDate);
    int recordCountCurrentShift = 0;

    if (currentRecord != null)
    {
        TimeSpan timedif = DateTime.Now - currentRecord.SDate;
        idletime = (decimal)timedif.TotalSeconds;
    }
    else
    {
        idletime = 0;
    }

    if (DateTime.Now >= shift1Start && DateTime.Now < shift1End)
    {
        shift = 1;
        recordCountCurrentShift = Model.listUsers.Count(u => u.SDate >= shift1Start && u.SDate < shift1End && u.MachineCode == "MCH1-02");
    }
    else if (DateTime.Now >= shift2Start && DateTime.Now < shift2End)
    {
        shift = 2;
        recordCountCurrentShift = Model.listUsers.Count(u => u.SDate >= shift2Start && u.SDate < shift2End && u.MachineCode == "MCH1-02");
    }
    else if ((DateTime.Now >= shift3Start && DateTime.Now < shift3End) || (DateTime.Now >= shift3Start2 && DateTime.Now < shift3End))
    {
        shift = 3;
        recordCountCurrentShift = Model.listUsers.Count(u => (((u.SDate >= shift3Start && u.SDate < shift3End) || (u.SDate >= shift3Start2 && u.SDate < shift3End2)) && u.MachineCode == "MCH1-02"));
    }

    string GetMachineName(string productId)
    {
        var product = Model.listCS.FirstOrDefault(p => p.Product_Id == productId);
        return product != null ? product.ProductName : "Model not found";
    }
    int getSUT(string productId)
    {
        var sutval = Model.listCS.FirstOrDefault(p => p.Product_Id == productId);
        return sutval != null ? sutval.SUT : 0;
    }
}

<style></style>

<div style="margin-bottom: 10px;"></div>

<div style="background-color: #180D2F; padding: 5px; color: #FFAE11; text-align: center;">
    <h3>Barcode Product Counter</h3>
</div>

<div style="margin-bottom: 7px;"></div>

<div style="background-color: #3c4561; padding: 5px; color: #FFAE11; display: flex;">
    <div style="flex: 1;">
        <div class="row m-2">
            <label class="col-sm-3 col-form-label" style="font-size:20px; font-weight:600; color: white">Machine :</label>
            @if (Model.listUsers.Count > 0 && currentRecord != null)
            {
                    <div class="col-sm-9 align-self-center" style="background-color: #87bbfa; font-weight:600; color: #180D2F">
                        <span style="font-size:20px;">CS Assembly</span>
                    </div>
            }
            else
            {
                    <div class="col-sm-9 align-self-center" style="background-color: #87bbfa; font-weight:600; color: #180D2F">
                        <span style="font-size:20px;"></span>
                    </div>
            }
        </div>
        <div class="row m-2">
            <label class="col-sm-3 col-form-label" style="font-size:20px; font-weight:600; color: white">Model :</label>
            @if (Model.listUsers.Count > 0 && currentRecord != null)
            {
                    <div class="col-sm-9 align-self-center" style="background-color: #87bbfa; font-weight:600; color: #180D2F">
                        <span style="font-size:20px;">@GetMachineName(currentRecord.Product_Id)</span>
                    </div>
            }
            else
            {
                    <div class="col-sm-9 align-self-center" style="background-color: #87bbfa; font-weight:600; color: #180D2F">
                        <span style="font-size:20px;"></span>
                    </div>
            }
        </div>
    </div>

    <div style="flex: 1;" class="align-self-center">
        @{
            var lastRecordForMachine = Model.listUsers
            .Where(u => u.MachineCode == "MCH1-02")
            .OrderByDescending(u => u.SDate)
            .FirstOrDefault();

            var latestTotalUnit = lastRecordForMachine != null ? (int)lastRecordForMachine.TotalUnit : 0;
        }

        @* @{
            var recordCountToday = 0;
            if (currentRecord != null && previousRecord != null && currentRecord.Product_Id == previousRecord.Product_Id)
            {
                recordCountToday = Model.listUsers.Count(u => (u.Date.Date == DateTime.Now.Date && u.MachineCode == "MCH1-01" && u.Product_Id == currentRecord.Product_Id));
            }
        } *@

        <div class="row m-2 text-end align-self-center">
            <div class="col-sm-6 align-self-center">
                <label style="font-size:20px; font-weight:600; color: white" id="counterlabelcs">Total Product :</label>
            </div>
            <div class="col-sm-6" style="background-color: #87bbfa; font-weight:600; color: #180D2F">
                <span style="font-size:50px;" id="countervaluecs">@latestTotalUnit</span>
            </div>
        </div>
    </div>
</div>

<div class="row d-flex justify-content-between">
    <div class="col-md-3" style="width:49%">
        <form method="post" id="myForm">
            <div class="row mt-2 mb-2" style="font-size: 28px; font-weight:500">
                <label class="col-sm-3 col-form-label" style="width:300px">Scan Serial Number :</label>
                <div class="col-sm-3 align-self-center">
                    <input type="text" class="form-control" id="serialNum"  name="SerialNum" value="@Model.iniUser.SN_GOOD" id="serial-number-input" form="myForm" autofocus style="font-size:28px; width:270px" />
                </div>
            </div>
            @* <input type="number" class="form-control" name="OP" id="opInputValue" form="myForm"/>
            <input type="number" class="form-control d-none" name="PP" id="prodInputValue" form="myForm" /> *@
        </form>
    </div>

    <div class="col-md-3" style="width:49%">
        <div class="row mt-2 mb-2 align-items-center justify-content-center" style="font-size: 28px; font-weight:500">
            <label class="col-sm-3 col-form-label" style="width:200px">Mode Shift : </label>
            <div class="col-sm-3 mt-2">
                <label class="slider-switch">
                    <input type="checkbox" id="switchButtoncs" @(shift == 1 ? "checked" : "") onchange="toggleSwitchCS()">
                    <span class="slider round"></span>
                </label>
            </div>
        </div>
    </div>

</div>

<div class="modal fade" id="CSProductionModal" tabindex="-1" data-bs-backdrop="static" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Produksi CS</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="CloseCSModal"></button>
            </div>
            <div class="modal-body">
                <div>
                    <label class="col col-form-label" style="font-weight:bold;">Masukkan Jumlah Operator!!</label>
                </div>
                    <input type="number" class="form-control" name="OP" id="opInput" value="@Model.iniUser.NoOfOperator" form="myForm" style="font-size:28px;" />
                <div>
                    <label class="col col-form-label" style="font-weight:bold;">Masukkan Jumlah Production Plan!!</label>
                </div>
                <input type="number" class="form-control" name="PP" id="prodInput" value="@Model.iniUser.TargetUnit" form="myForm" style="font-size:28px;" />
                <div class="d-flex w-100 justify-content-end">
                    <button id="close" class="btn btn-primary mt-3">Submit</button>
                </div>
            </div>
        </div>
    </div>
</div>

<input type="number" class="form-control" name="TU" id="targInput" value="@Model.iniUser.TargetUnit" form="myForm" style="font-size:28px; display:none" />
<input type="hidden" class="form-control" name="IT" id="idleInput" value="@Model.iniUser.IdleTime" form="myForm" style="font-size:28px; display:none " />

@if (currentRecord != null)
{
        <div class="row" style="font-size: 28px; font-weight:500">
            <div class="col-sm-3">
                <label>Current Record :</label>
            </div>
            <div class="col-sm-3">
                <span id="currentRecordValue">@currentRecord.SN_GOOD</span>
            </div>
        </div>
}
else
{
        <div class="row" style="font-size: 28px; font-weight:500">
            <div class="col-sm-3">
                <label>Current Record :</label>
            </div>
            <div class="col-sm-3">
                <span id="currentRecordValue">No current record found.</span>
            </div>
        </div>
}

@if (previousRecord != null)
{

        <div class="row" style="font-size: 28px; font-weight:500">
            <div class="col-sm-3">
                <label>Previous Record :</label>
            </div>
            <div class="col-sm-3">
                <span>@previousRecord.SN_GOOD</span>
            </div>
        </div>
}
else
{
        <div class="row" style="font-size: 28px; font-weight:500">
            <div class="col-sm-3">
                <label>Previous Record :</label>
            </div>
            <div class="col-sm-3">
                <span>No previous record found.</span>
            </div>
        </div>
}

<div class="row" style="font-size: 28px; font-weight:500; display:none">
    <label class="col-sm-3 col-form-label">Jumlah Operator :</label>
    <div class="col-sm-3 align-self-center">
        <div id="opDisplay" style="font-size: 28px; font-weight: bold; color: #87bbfa;"></div>
    </div>
</div>

<div class="row" style="font-size: 28px; font-weight:500; display:none">
    <label class="col-sm-3 col-form-label">Production Plan :</label>
    <div class="col-sm-3 align-self-center">
        <div id="prodDisplay" style="font-size: 28px; font-weight: bold; color: #87bbfa;"></div>
    </div>
</div>

<div class="row" style="font-size: 28px; font-weight:500; display:none">
    <label class="col-sm-3 col-form-label">Target Unit :</label>
    <div class="col-sm-3 align-self-center">
        <div id="interDisp" style="font-size: 28px; font-weight: bold; color: #87bbfa;"></div>
    </div>
</div>


@if (!string.IsNullOrEmpty(Model.errorMessage))
{
        <div class="alert alert-dismissible fade show d-flex justify-content-center align-items-center" style="background-color:black">
            <strong style="font-size:20px; color:red">@Model.errorMessage</strong>
        </div>
}


<div>
    <table class="table table-bordered table-striped mt-3" style="font-size:15px">
        <thead>
            <tr>
                <th>Date</th>
                <th>Time</th>
                <th>Machine</th>
                <th>Model</th>
                <th>Serial Number</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.listUsers.Where(u => (u.SDate.Date == DateTime.Now.Date && u.MachineCode == "MCH1-02")).OrderByDescending(u => u.SDate).Take(5))
            {
                    <tr style="font-weight:bold">
                        <td>@item.Date.ToShortDateString()</td>
                        <td>@item.SDate.ToString("HH:mm:ss").Replace('.', ':')</td>
                        <td>CS Assembly</td>
                        <td>@GetMachineName(item.Product_Id)</td>
                        <td>@item.SN_GOOD</td>
                    </tr>
            }
        </tbody>
    </table>
</div>

<component type="typeof(LossTimeModal)" render-mode="ServerPrerendered" />

@* IN DEVELOPMENT *@
@*<div class="modal fade" id="LossTime" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" aria-labelledby="LossTime" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content p-4">
            <div class="modal-header">
                <h2 class="fs-4 fw-bold">Loss Time</h2>
            </div>
            <div class="modal-body">
                <h4 class="mb-4 text-center">There is Loss Time in Production, What is the reason?</h4>

                <form method="post" asp-page-handler="SaveLossTime">
                    <input type="hidden" name="LossTimeReason" id="LossTimeReasonInput" />

                    <div class="d-flex gap-3 justify-content-center mb-2">
                        <button type="submit" class="btn w-75 btn-outline-primary reason-btn" data-reason="Change Model">
                            <h2 class="text-center p-4 fw-bold">Change Model</h2>
                        </button>
                        <button type="submit" class="btn w-75 btn-outline-primary reason-btn" data-reason="Material Shortage External">
                            <h2 class="text-center p-4 fw-bold">Material Shortage External</h2>
                        </button>
                        <button type="submit" class="btn w-75 btn-outline-primary reason-btn" data-reason="MP Adjustment">
                            <h2 class="text-center p-4 fw-bold">MP Adjustment</h2>
                        </button>
                        <button type="submit" class="btn w-75 btn-outline-primary reason-btn" data-reason="Material Shortage Internal">
                            <h2 class="text-center p-4 fw-bold">Material Shortage Internal</h2>
                        </button>
                    </div>
                    <div class="d-flex gap-3 justify-content-center">
                        <button type="submit" class="btn w-75 btn-outline-primary reason-btn" data-reason="Material Shortage Inhouse">
                            <h2 class="text-center p-4 fw-bold">Material Shortage Inhouse</h2>
                        </button>
                        <button type="submit" class="btn w-75 btn-outline-primary reason-btn" data-reason="Quality Trouble">
                            <h2 class="text-center p-4 fw-bold">Quality Trouble</h2>
                        </button>
                        <button type="submit" class="btn w-75 btn-outline-primary reason-btn" data-reason="Machine Trouble">
                            <h2 class="text-center p-4 fw-bold">Machine Trouble</h2>
                        </button>
                        <button type="submit" class="btn w-75 btn-outline-primary reason-btn" data-reason="Rework">
                            <h2 class="text-center p-4 fw-bold">Rework</h2>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>*@
@* IN DEVELOPMENT - Batas Development *@
@section Scripts {
            <script>
                // Declare 'operat' variable' and initialize it with 0
                var operat = 0;
                var prodpl = 0;
                var intVal = 0;
                var intervalId;
                document.addEventListener("DOMContentLoaded", function () {
                    var opInput = document.getElementById("opInput");
                    var prodInput = document.getElementById("prodInput");
                    var opInputValue = document.getElementById("opInputValue");
                    var prodInputValue = document.getElementById("prodInputValue");

                    setInterval(() => { 
                        opInputValue.value = opInput.value;
                        prodInputValue.value = prodInput;
                    }, 500)

                    // enter to submit
                    const form = document.getElementById("myForm");
                    const input = document.getElementById("serialNum");

                    form.addEventListener("keydown", function (event) {
                        if (event.key === "Enter") {
                            event.preventDefault();
                            form.submit();
                        }
                    });

                    const close = document.getElementById('close');
                    const closebtn = document.getElementById('CloseCSModal');

                    close.addEventListener('click', () => {
                        closebtn.click();
                    });
                    // Load the switch state and OP value from local storage on page load
                    var switchButtoncs = document.getElementById("switchButtoncs");
                    var labelcs = document.getElementById("counterlabelcs");
                    var valuecs = document.getElementById("countervaluecs");
                    // var opInput = document.getElementById("opInput");
                    // var prodInput = document.getElementById("prodInput");
                    var targInput = document.getElementById("targInput");
                    var idleInput = document.getElementById("idleInput");

                    var targValue = localStorage.getItem("intVal");
                    if (targValue != null) {
                        targInput.value = targValue;
                        intVal = parseInt(targValue);
                    }

                    //get the switch state from local storage
                    var switchStatecs = localStorage.getItem("switchStatecs");
                    if (switchStatecs !== null) {
                        switchButtoncs.checked = JSON.parse(switchStatecs);
                    }

                    var opValue = localStorage.getItem("opValuecs");
                    if (opValue !== null) {
                        opInput.value = opValue;
                        // Update 'operat' variable with the initial "OP" value
                        operat = parseInt(opValue);
                    }

                    var prodValue = localStorage.getItem("prodValuecs");
                    if (prodValue !== null) {
                        prodInput.value = prodValue;
                        prodpl = parseInt(prodValue);
                    }

                    // Update the display of OP value when the page loads
                    updateOPDisplay(opValue);
                    updatePPDisplay(prodValue);

                    // Save the switch state and OP value to local storage and update UI when the switch is toggled
                    switchButtoncs.addEventListener("change", function () {
                        localStorage.setItem("switchStatecs", switchButtoncs.checked);
                        toggleSwitchCS();
                    });
                    opInput.addEventListener("change", function () {
                        localStorage.setItem("opValuecs", opInput.value);
                        updateOPDisplay(opInput.value);
                        // Update 'operat' variable with the new "OP" value
                        operat = parseInt(opInput.value);
                    });
                    prodInput.addEventListener("change", function () {
                        localStorage.setItem("prodValuecs", prodInput.value);
                        updatePPDisplay(prodInput.value);
                        prodpl = parseInt(prodInput.value);
                    });
                        function updateVariable() {
                        const now = new Date();
                        
                        let startOfShift = new Date(now);
                        startOfShift.setHours(7, 0, 0, 0);

                        if (now.getHours() < 7) {
                            startOfShift.setDate(startOfShift.getDate() - 1);
                        }

                        const timeDiffSeconds = Math.floor((now - startOfShift) / 1000);

                        const sutVal = @getSUT(currentRecord.Product_Id);
                        if (sutVal > 0) {
                            intVal = Math.floor(timeDiffSeconds / sutVal);

                            localStorage.setItem("intValcu", intVal);
                            var targValue = localStorage.getItem("intValcu");
                            if (targValue != null) {
                                targInput.value = targValue;
                            }
                            updateIntValDisplay();
                        }
                    }
                // var lastRecordValue = document.getElementById("currentRecordValue").innerText;
                // var lastUpdateTime = new Date().getTime(); Waktu saat nilai terakhir berubah

                // ***MULAI MODIFIKASI: Definisikan ambang batas***
                // var SUTTime = @(currentRecord != null ? getSUT(currentRecord.Product_Id) : 0);
                // var losstimethreshold = SUTTime > 0 ? SUTTime * 3 * 1000 : 180000; Gunakan default 3 menit jika SUT bernilai 0
                // var twoHourThreshold = 2 * 60 * 60 * 1000; 2 jam dalam milidetik
                // ***AKHIR MODIFIKASI***

                // console.log("berjalan");


                // ***MULAI MODIFIKASI: Fungsi checkLossTime yang diperbarui***
                // function checkLossTime() {
                //     var currentRecordValue = document.getElementById("currentRecordValue").innerText;
                //     var currentTime = new Date().getTime();
                //     var switchButton = document.getElementById("switchButtoncs");

                //     Jika produk baru di-scan, reset timernya
                //     if (currentRecordValue !== lastRecordValue) {
                //         lastRecordValue = currentRecordValue;
                //         lastUpdateTime = currentTime; 
                //         return; Keluar dari fungsi setelah reset
                //     }

                //     var idleTime = currentTime - lastUpdateTime;
                //     var isModalShown = document.getElementById('LossTime').classList.contains('show');

                //     Jangan lanjutkan jika modal sudah terlihat
                //     if (isModalShown) {
                //         return;
                //     }

                //     Logika saat MODE SHIFT MATI
                //     if (!switchButton.checked) {
                //         Tampilkan modal HANYA jika waktu idle berada di antara ambang batas SUT dan 2 jam
                //         if (idleTime > losstimethreshold && idleTime < twoHourThreshold) {
                //             console.log("Mode Shift MATI. Waktu idle di antara ambang SUT dan 2 jam. Menampilkan modal.");
                //             var lossTimeModal = new bootstrap.Modal(document.getElementById("LossTime"));
                //             lossTimeModal.show();
                //         }
                //         Jika idleTime > twoHourThreshold, jangan lakukan apa-apa, sesuai permintaan.
                //     }
                //     Logika saat MODE SHIFT NYALA (logika asli)
                //     else {
                //         if (idleTime > losstimethreshold) {
                //             console.log("Mode Shift NYALA. Waktu idle melebihi ambang SUT. Menampilkan modal.");
                //             var lossTimeModal = new bootstrap.Modal(document.getElementById("LossTime"));
                //             lossTimeModal.show();
                //         }
                //     }
                // }
                // ***AKHIR MODIFIKASI***


                // document.querySelectorAll('.reason-btn').forEach(button => {
                //     button.addEventListener('click', function (event) {
                //         event.preventDefault(); Mencegah submit langsung sebelum input diisi
                //         let reason = this.getAttribute('data-reason');
                //         console.log("data reason sebelum :" + reason);
                //         Masukkan alasan ke input tersembunyi
                //         let inputField = document.getElementById('LossTimeReasonInput');
                //         if (!inputField) {
                //             console.error("Input LossTimeReasonInput tidak ditemukan!");
                //             return;
                //         }

                //         inputField.value = reason;
                //         console.log("Mengirim form dengan reason:", reason);
                //         let form = this.closest('form');
                //         if (!form) {
                //             console.error("Form tidak ditemukan!");
                //             return;
                //         }

                //         form.submit();
                //     });
                // });

                // document.querySelectorAll(".reason-btn").forEach(button => {
                //     button.addEventListener("click", function () {
                //         lastUpdateTime = new Date().getTime(); Reset waktu setelah memilih alasan
                //         var lossTimeModal = document.getElementById("LossTime");
                //         var modalInstance = bootstrap.Modal.getInstance(lossTimeModal);
                //         if (!modalInstance) {
                //             modalInstance = new bootstrap.Modal(lossTimeModal);
                //         }
                //         modalInstance.hide();Tutup modal setelah memilih alasan
                //         document.querySelectorAll('.modal-backdrop').forEach(el => el.remove()); Hapus backdrop yang tersisa
                //     });

                //     document.getElementById("LossTime").addEventListener("hidden.bs.modal", function () {
                //         let serialInput = document.getElementById("serialNum");
                //         if (serialInput) {
                //             setTimeout(() => {
                //                 serialInput.focus();
                //             }, 10); Delay sedikit agar transisi modal selesai dulu
                //         }
                //     });
                // });




                //     function addIdle() {
                //         Pastikan ada nilai yang valid untuk dikirim ke backend
                //         idleInput.value = "@(currentRecord != null ? currentRecord.SDate.ToString("yyyy-MM-dd HH:mm:ss") : DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss"))";
                //     }

                //     function updateIntValDisplay() {
                //         var interDisp = document.getElementById("interDisp");
                //         interDisp.textContent = intVal;
                //     }

                //     Function to update the display of the OP value
                //     function updateOPDisplay(value) {
                //         var opDisplay = document.getElementById("opDisplay");
                //         opDisplay.textContent = value;
                //     }

                //     function updatePPDisplay(value) {
                //         var prodDisplay = document.getElementById("prodDisplay");
                //         prodDisplay.textContent = value;
                //     }

                //     Function to handle the switch button behavior
                //     function toggleSwitchCS() {
                //         var switchButtoncs = document.getElementById("switchButtoncs");
                //         var labelcs = document.getElementById("counterlabelcs");
                //         var valuecs = document.getElementById("countervaluecs");
                //         var opInput = document.getElementById("opInput");
                //         var prodInput = document.getElementById("prodInput");
                //         if (switchButtoncs.checked) {
                //             labelcs.textContent = "Shift @shift Total Product : ";
                //             valuecs.textContent = "@recordCountCurrentShift";
                //             var currentTime = new Date();
                //             if ((currentTime.getHours() === 7 && currentTime.getMinutes() === 0 && currentTime.getSeconds() < 20) || (currentTime.getHours() === 15 && currentTime.getMinutes() === 45 && currentTime.getSeconds() < 20) || (currentTime.getHours() === 23 && currentTime.getMinutes() === 0 && currentTime.getSeconds() < 20)) {
                //                 operat = 0;
                //                 opInput.value = operat;
                //                 updateOPDisplay(operat);
                //                 localStorage.setItem("opValuecs", operat);

                //                 prodpl = 0;
                //                 prodInput.value = prodpl;
                //                 updatePPDisplay(prodpl);
                //                 localStorage.setItem("prodValuecs", prodpl);

                //                 intVal = 0;
                //                 targInput.value = intVal;
                //                 updateIntValDisplay();
                //                 localStorage.setItem("intVal", intVal);

                //                 reloadPage()
                //             }
                //         } else {
                //             labelcs.textContent = "Total Product : ";
                //             valuecs.textContent = "@latestTotalUnit";
                //             var currentTime = new Date();
                //             if ((currentTime.getHours() === 10 && currentTime.getMinutes() === 30 && currentTime.getSeconds() < 20) || (currentTime.getHours() === 16 && currentTime.getMinutes() === 0 && currentTime.getSeconds() < 20)) {
                //                 operat = 0;
                //                 opInput.value = operat;
                //                 updateOPDisplay(operat);
                //                 localStorage.setItem("opValuecs", operat);

                //                 prodpl = 0;
                //                 prodInput.value = prodpl;
                //                 updatePPDisplay(prodpl);
                //                 localStorage.setItem("prodValuecs", prodpl);

                //                 intVal = 0;
                //                 targInput.value = intVal;
                //                 updateIntValDisplay();
                //                 localStorage.setItem("intVal", intVal);

                //                 reloadPage()
                //             }
                //         }
                //     }
                //     ceklosstime
                // setInterval(checkLossTime, 2000);
                //     Call the toggleSwitch function on page load to initialize the switch button state
                //     toggleSwitchCS();
                //     addIdle();

                //     Retrieve the previous interval ID from session storage and update 'intervalId' variable
                //     function reloadPage() {
                //         location.reload();
                //     }

                //     if (operat == 0 || prodpl == 0 || operat == null || prodpl == null) {
                //         modal_container.classList.add('show');
                //     }

                //     Set the interval and store the interval ID in session storage
                //     setInterval(updateVariable, 900);
                //     Retrieve 'intVal' from localStorage and update the display
                //     intVal = parseInt(localStorage.getItem("intVal")) || 0;
                //     updateIntValDisplay();

                });
            </script>
    }